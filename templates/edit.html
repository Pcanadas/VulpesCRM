{% extends "includes/base.html" %}

{% block content %}
<main class="col-md-12 sm-auto col-sm-10 px-sm-4 py-4">
    <div class="col-md-12">
        <h1 class="h2">Editar oferta</h1>
    </div>
    {% if edit_item == 'editar_oferta' %}
        <div class="card border-primary mb-3 col-md-12">
            {% if error %}
            <p style="color: red;"><strong>Error:</strong> {{ error }}</p>
            {% endif %}
            {% if oferta %}
                <form action="/edit/{{oferta.id}}" method="post" class="needs-validation" novalidate>
                    <input type="text" name="id" class="form-control" value="{{ oferta.id }}" required hidden>
                    <fieldset style="padding:10px;">
                        {{ form.hidden_tag() }}
                        <div class="row">
                        <div class="form-group col">
                            {{ form.noferta.label(class_="col-form-label-sm") }}
                            {{ form.noferta(class_="form-control", size=12, value=oferta.noferta)}}<br>
                            {% for error in form.noferta.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.fecha.label(class_="col-form-label-sm") }}
                            {{ form.fecha(class_="form-control", value=oferta.fecha.strftime("%d/%m/%Y")) }}
                            <small id="fechaHelp" class="form-text text-muted">dd/mm/aaaa</small><br>
                            {% for error in form.fecha.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.id_empresa.label(class_="col-form-label-sm") }}
                            {{ form.id_empresa(class_="form-select", value=oferta.id_empresa) }}<br>
                            {% for error in form.id_empresa.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col">
                            {{ form.cliente.label(class_="col-form-label-sm") }}
                            {{ form.cliente(class_="form-control", value=oferta.cliente) }}<br>
                            {% for error in form.cliente.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.nombre.label(class_="col-form-label-sm") }}
                            {{ form.nombre(class_="form-control", value=oferta.nombre) }}<br>
                            {% for error in form.nombre.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.telefono.label(class_="col-form-label-sm") }}
                            {{ form.telefono(class_="form-control", value=oferta.telefono) }}<br>
                            {% for error in form.telefono.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.email.label(class_="col-form-label-sm") }}
                            {{ form.email(class_="form-control", value=oferta.email) }}<br>
                            {% for error in form.email.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.ciudad.label(class_="col-form-label-sm") }}
                            {{ form.ciudad(class_="form-control", value=oferta.ciudad) }}<br>
                            {% for error in form.ciudad.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col">
                            {{ form.nombre_producto.label(class_="col-form-label-sm") }}
                            {{ form.nombre_producto(class_="form-control", value=oferta.nombre_producto) }}<br>
                            {% for error in form.nombre_producto.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.marca.label(class_="col-form-label-sm") }}
                            {{ form.marca(class_="form-control", value=oferta.marca) }}<br>
                            {% for error in form.marca.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col">
                            {{ form.importe.label(class_="col-form-label-sm") }}
                            {{ form.importe(class_="form-control", value=oferta.importe) }}<br>
                            {% for error in form.importe.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.descuento.label(class_="col-form-label-sm") }}
                            {{ form.descuento(class_="form-control", value=oferta.descuento) }}<br>
                            {% for error in form.descuento.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.fecha_demo.label(class_="col-form-label-sm") }}
                            {% if oferta.fecha_demo != None: %}
                                {{ form.fecha_demo(class_="form-control", value=oferta.fecha_demo.strftime("%d/%m/%Y")) }}
                            <small id="fecha_demoHelp" class="form-text text-muted">dd/mm/aaaa</small><br>
                            {% else: %}
                                {{ form.fecha_demo(class_="form-control")}}<br>
                            {% endif %}
                            {% for error in form.fecha_demo.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.fecha_visita.label(class_="col-form-label-sm") }}
                            {% if oferta.fecha_visita != None: %}
                                {{ form.fecha_visita(class_="form-control", value=oferta.fecha_visita.strftime("%d/%m/%Y")) }}
                            <small id="fecha_visitaHelp" class="form-text text-muted">dd/mm/aaaa</small><br>
                            {% else: %}
                                {{ form.fecha_visita(class_="form-control")}}<br>
                            {% endif %}
                            {% for error in form.fecha_visita.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.probabilidad.label(class_="col-form-label-sm") }}
                            {{ form.probabilidad(class_="form-select", value=oferta.probabilidad) }}<br>
                            {% for error in form.probabilidad.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.via.label(class_="col-form-label-sm") }}
                            {{ form.via(class_="form-select", value=oferta.via) }}<br>
                            {% for error in form.via.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col">
                            {{ form.persona.label(class_="col-form-label-sm") }}
                            {{ form.persona(class_="form-control", value=oferta.persona) }}<br>
                            {% for error in form.persona.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.fecha_compra.label(class_="col-form-label-sm") }}
                            {% if oferta.fecha_compra != None: %}
                                {{ form.fecha_compra(class_="form-control", value=oferta.fecha_compra.strftime("%d/%m/%Y")) }}
                            <small id="fecha_compraHelp" class="form-text text-muted">dd/mm/aaaa</small><br>
                            {% else: %}
                                {{ form.fecha_compra(class_="form-control")}}<br>
                            {% endif %}
                            {% for error in form.fecha_compra.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.resultado.label(class_="col-form-label-sm") }}
                            {{ form.resultado(class_="form-select", value=oferta.resultado) }}<br>
                            {% for error in form.resultado.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.fecha_resultado.label(class_="col-form-label-sm") }}
                            {% if oferta.fecha_resultado != None: %}
                                {{ form.fecha_resultado(class_="form-control", value=oferta.fecha_resultado.strftime("%d/%m/%Y")) }}
                            <small id="fecha_resultadoHelp" class="form-text text-muted">dd/mm/aaaa</small><br>
                            {% else: %}
                                {{ form.fecha_resultado(class_="form-control")}}<br>
                            {% endif %}
                            {% for error in form.fecha_resultado.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group col">
                            {{ form.grupo_marketing.label(class_="col-form-label-sm") }}
                            {{ form.grupo_marketing(class_="form-select", value=oferta.grupo_marketing) }}<br>
                            {% for error in form.grupo_marketing.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="form-group">
                        {{ form.comentarios.label(class_="col-form-label-sm") }}
                        <textarea class="form-control" name="comentarios" id="comentarios" rows="3" value="{{ form.comentarios }}"></textarea>
                        <br>
                        {% for error in form.comentarios.errors %}
                        <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                    </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary  mt-3">Modificar oferta</button>
                        </div>
                    </fieldset>
                </form>
            {% endif %}
        </div>
    {% elif edit_item == 'editar_usuario' %}
        <div class="card border-primary mb-3 col-md-8">
            {% if error %}
            <p style="color: red;"><strong>Error:</strong> {{ error }}</p>
            {% endif %}
            {% if users %}
                <form action="/editu/{{users.id}}" method="POST" class="needs-validation" novalidate>
                    <input type="text" name="id" class="form-control" value="{{ users.id }}" required hidden>
                    <input type="text" name="password" class="form-control" value="{{ users.password }}" required hidden>
                    <fieldset style="padding:10px;">
                        {{ form.hidden_tag() }}
                        <div class="form-group">
                            {{ form.name.label(class="form-label mt-3") }}
                            {{ form.name(class_="form-control", size=60, value=users.name) }}
                            {% for error in form.name.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group">
                            {{ form.surname.label(class="form-label mt-3") }}
                            {{ form.surname(class_="form-control", size=80, value=users.surname) }}
                            {% for error in form.surname.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group">
                            {{ form.email.label(class="form-label mt-3") }}
                            {{ form.email(class_="form-control", size=256, value=users.email) }}
                            {% for error in form.email.errors %}
                            <span style="color: red;">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="form-group">
                            <div class="form-group form-check mt-3">
                                {% if users.is_admin == True %}
                                    {{ form.is_admin(type="checkbox", checked="") }}
                                {% else %}
                                    {{ form.is_admin(type="checkbox") }}
                                {% endif %}
                                {{ form.is_admin.label }}
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary  mt-3">Modificar cliente</button>
                        </div>
                    </fieldset>
                </form>
            {% endif %}
        </div>
    {% endif %}
</main>
{% endblock content %}